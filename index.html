
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø±Ø§Ù‚Ø¨Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f4f4f4;
      padding: 20px;
      direction: rtl;
      text-align: center;
    }
    h2 { color: #00695c; }
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    th {
      background: #004d40;
      color: white;
    }
    .alert { background: #fff3cd; color: #856404; font-weight: bold; }
    .good { color: green; font-weight: bold; }
    .bad { color: red; font-weight: bold; }
    #loading { color: #00695c; font-weight: bold; margin-top: 10px; }
    #count { margin-top: 10px; font-weight: bold; color: #004d40; }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      background: #00796b;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #004d40;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ˆ Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ±Ø© <span dir="ltr">142857</span> Ø£Ùˆ <span dir="ltr">90</span></h2>
  <div id="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  <div id="count"></div>
  <table id="results">
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„Ø±Ù…Ø²</th>
        <th>Ø§Ù„Ø³ÙˆÙ‚</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>ÙØ±Ù‚ 142857</th>
        <th>ÙØ±Ù‚ 90</th>
        <th>Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ø¯Ù…</th>
        <th>ØªÙ†Ø¨ÙŠÙ‡</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="saveData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
  <button onclick="copyToClipboard()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ†Øµ</button>
  <audio id="alertSound" src="https://www.soundjay.com/buttons/beep-07.wav" preload="auto"></audio>

  <script>
    const usSymbols = [
      'AAPL','MSFT','TSLA','NVDA','AMZN','META','GOOGL','NFLX','INTC','AMD',
      'BABA','CRM','ORCL','CSCO','QCOM','ADBE','AVGO','TXN','PYPL','SHOP',
      'ZM','UBER','ABNB','PLTR','ROKU','COIN','SQ','MRNA','PFE','JNJ',
      'XOM','CVX','BA','GE','GM','F','T','VZ','WMT','COST',
      'NKE','SBUX','MCD','DIS','PEP','KO','WFC','BAC','GS','JPM','CNSP'
    ];

    const saSymbols = [
      '2222','2010','1211','7010','2380','2020','3030','TADAWUL',
      '1050','1040','1060','1080','1140','1150','8230','8170','8010','8210','8310','8280',
      '6050','6020','6010','4002','4260','4080','4200','4013','4008','4050'
    ];

    const allSymbols = usSymbols.map(s => ({ symbol: s, market: 'ğŸ‡ºğŸ‡¸ Ø£Ù…Ø±ÙŠÙƒØ§' }))
      .concat(saSymbols.map(s => ({ symbol: s + ".SR", market: 'ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' })));

    const base142857 = 142857;
    const base90 = 90;
    const savedData = [];

    async function fetchData(symbol) {
      try {
        const res = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`);
        const data = await res.json();
        const price = data?.chart?.result?.[0]?.meta?.regularMarketPrice;
        return price ? { symbol, price } : null;
      } catch (err) {
        console.warn('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', symbol);
        return null;
      }
    }

    async function analyze() {
      const table = document.querySelector('#results tbody');
      const countDiv = document.getElementById('count');
      let matchCount = 0;
      let counter = 1;

      for (const { symbol, market } of allSymbols) {
        const data = await fetchData(symbol);
        if (!data || !data.price) continue;

        const price = data.price;
        const diff142857 = Math.abs(price - Math.round(price / base142857) * base142857);
        const diff90 = Math.abs(price - Math.round(price / base90) * base90);
        const percent = ((price % base142857) / base142857 * 100);

        const isNear = diff142857 < 1 || diff90 < 1 || percent >= 99;

        if (isNear) {
          document.getElementById("alertSound").play();
          matchCount++;
          const rowData = {
            symbol: symbol.replace('.SR', ''),
            market,
            price: price.toFixed(2),
            diff142857: diff142857.toFixed(2),
            diff90: diff90.toFixed(2),
            percent: percent.toFixed(2) + '%'
          };
          savedData.push(rowData);

          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${counter++}</td>
            <td>${rowData.symbol}</td>
            <td>${rowData.market}</td>
            <td>${rowData.price}</td>
            <td>${rowData.diff142857}</td>
            <td>${rowData.diff90}</td>
            <td>${rowData.percent}</td>
            <td class="alert">âš ï¸ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ±Ø©</td>
          `;
          table.appendChild(row);
        }
      }

      countDiv.textContent = `âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${matchCount} Ù…Ù† Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ±Ø©.`;
      document.getElementById('loading').style.display = 'none';
    }

    function saveData() {
      if (savedData.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­ÙØ¸Ù‡Ø§.');
        return;
      }
      const content = JSON.stringify(savedData, null, 2);
      const blob = new Blob([content], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cycle-alerts.json';
      a.click();
    }

    function copyToClipboard() {
      if (savedData.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù†Ø³Ø®Ù‡Ø§.");
        return;
      }

      const rows = savedData.map((item, idx) =>
        `${idx + 1}. ${item.symbol} (${item.market}) - Ø§Ù„Ø³Ø¹Ø±: ${item.price} - ÙØ±Ù‚ 142857: ${item.diff142857} - ÙØ±Ù‚ 90: ${item.diff90} - ØªÙ‚Ø¯Ù…: ${item.percent}`
      ).join('\n');

      navigator.clipboard.writeText(rows).then(() => {
        alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!");
      });
    }

    analyze();
  </script>
</body>
</html>
